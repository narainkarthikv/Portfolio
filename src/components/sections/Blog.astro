---
import Section from "../Section.astro";
import { basics } from "@cv";

// Use the username from your provided code
const MEDIUM_USERNAME = "narainkarthikv"; 

// Fix: Encode the feed URL to handle the '@' symbol correctly
const FEED_URL = `https://medium.com/feed/@${MEDIUM_USERNAME}`;
const RSS_URL = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(FEED_URL)}`;

let posts = [];

try {
  // Fetching from the rss2json API as defined in the project requirements
  const response = await fetch(RSS_URL);
  const data = await response.json();
  
  if (data.status === 'ok' && data.items) {
    // Slice to show only top 3 as requested for the home page
    posts = data.items.slice(0, 3);
  } else {
    console.error("RSS API Error:", data.message || "Unknown error");
  }
} catch (e) {
  console.error("Home page blog fetch failed:", e);
}

const { className } = Astro.props;
---

<Section title="Latest Posts" className={className}>
  <div class="flex flex-col gap-y-4">
    {posts.length > 0 ? (
      posts.map((post) => (
        <div class="flex flex-col gap-1 border-b border-skin-muted/10 pb-3 last:border-0">
          <div class="flex items-center justify-between gap-2">
            <h3 class="text-sm font-medium">
              <a 
                href={post.link} 
                target="_blank" 
                rel="noopener noreferrer"
                class="hover:text-skin-hue transition-colors line-clamp-1"
              >
                {post.title}
              </a>
            </h3>
            <time class="text-[10px] text-skin-muted whitespace-nowrap">
              {new Date(post.pubDate).toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
            </time>
          </div>
        </div>
      ))
    ) : (
      <p class="text-xs text-skin-muted italic">No recent posts found.</p>
    )}
    
    <a 
      href="/blog" 
      class="text-xs font-semibold text-skin-hue hover:underline mt-2 flex items-center gap-1"
    >
      View all articles â†’
    </a>
  </div>
</Section>