---
import Section from '../Section.astro'
import { skills } from '@cv'
import { Icon } from 'astro-icon/components'
---

<Section className={Astro.props.className} title="Skills">
  <!-- ========================= -->
  <!-- Mobile / Tablet Skills -->
  <!-- ========================= -->
  <ul
    class="
      lg:hidden
      inline-flex flex-wrap gap-3
      print:mt-4
      [&>li>svg]:text-skin-hue
    "
  >
    {skills.map(({ name, icon, level }) => (
      <li
        class="
          group relative flex items-center gap-1.5
          rounded-lg border border-skin-hue/20
          bg-skin-button-accent/20
          backdrop-blur-md
          px-3 py-2
          text-xs text-skin-base font-medium
          cursor-default
          transform transition-all duration-300
          hover:scale-110 hover:-translate-y-1
          hover:bg-skin-button-accent/30
          hover:border-skin-hue/35
          hover:backdrop-blur-lg
          ring-1 ring-inset ring-white/10 dark:ring-white/5
          print:border-none print:bg-transparent print:p-0 print:text-zinc-800
        "
      >
        {icon && (
          <Icon
            name={icon}
            width={16}
            height={16}
            class="text-skin-hue"
            title={level}
          />
        )}
        <span>{name}</span>

        <!-- Level reveal on hover (mobile safe) -->
        <span
          class="
            pointer-events-none absolute inset-x-0 top-full mt-2
            text-[10px] text-skin-muted font-medium
            opacity-0 translate-y-1
            transition-all duration-200
            group-hover:opacity-100 group-hover:translate-y-0
          "
        >
          {level}
        </span>
      </li>
    ))}
  </ul>

  <!-- ========================= -->
  <!-- Desktop Skills Grid -->
  <!-- ========================= -->
  <div class="relative hidden lg:block">
    <!-- Ambient glow -->
    <div class="pointer-events-none absolute inset-0 -z-10">
      <div
        class="absolute left-1/2 top-28 h-[380px] w-[380px]
               -translate-x-1/2 rounded-full
               bg-skin-hue/10 blur-3xl">
      </div>
    </div>

    <!-- Skills Grid -->
    <div
      class="
        skills-grid
        grid
        grid-cols-8
        xl:grid-cols-9
        gap-x-8 gap-y-12
        place-items-center
      "
    >
      {skills.map(({ name, icon, level, keywords }, index) => (
        <div class="skill-item group relative flex items-center justify-center">
          <!-- Icon Button -->
          <button
            class={`
              relative flex items-center justify-center
              h-14 w-14
              rounded-full
              bg-skin-button-muted/65 dark:bg-skin-button-muted/55
              backdrop-blur-xl
              text-skin-hue

              transition-all duration-300 ease-out
              hover:-translate-y-0.5 hover:scale-[1.08]
              hover:bg-skin-button-muted/75 dark:hover:bg-skin-button-muted/65
              hover:backdrop-blur-2xl

              focus-visible:outline-none
              focus-visible:ring-2 focus-visible:ring-skin-hue/70
              focus-visible:ring-offset-2
              focus-visible:ring-offset-skin-fill

              ring-1 ring-inset
              ring-white/15 dark:ring-white/10

              ${index % 3 === 0 ? 'skill-float' : ''}
            `}
            aria-label={`${name} skill`}
          >
            {icon && (
              <Icon
                name={icon}
                class="h-6 w-6 text-skin-hue transition-transform duration-200 group-hover:scale-110"
                aria-hidden="true"
              />
            )}

            <!-- Skill level indicator -->
            <span
              class={`
                absolute -bottom-2 left-1/2 h-1
                -translate-x-1/2 rounded-full
                ${
                  level === 'Beginner'
                    ? 'w-5 bg-skin-hue/50'
                    : level === 'Intermediate'
                    ? 'w-8 bg-skin-hue/70'
                    : 'w-12 bg-skin-hue'
                }
              `}
              aria-hidden="true"
            />
          </button>

          <!-- Tooltip -->
          <div
            role="tooltip"
            class="
              skill-tooltip
              pointer-events-none absolute bottom-full left-1/2 z-[9999] mb-4
              w-60 max-w-[calc(100vw-2rem)] -translate-x-1/2
              whitespace-normal break-words
              rounded-2xl
              bg-skin-button-muted/75 dark:bg-skin-button-muted/65
              backdrop-blur-2xl
              px-4 py-3 shadow-xl

              ring-1 ring-inset
              ring-white/20 dark:ring-white/15

              opacity-0 scale-95 translate-y-2
              transition-all duration-200 ease-out
              group-hover:opacity-100
              group-hover:scale-100
              group-hover:translate-y-0
            "
          >
            <div class="space-y-2">
              <div class="flex items-center gap-2 text-sm font-semibold text-skin-base">
                <span>{name}</span>
                <span class="text-skin-muted">|</span>
                <span class="text-xs font-medium text-skin-muted">
                  {level}
                </span>
              </div>

              {keywords?.length > 0 && (
                <div class="flex flex-wrap gap-1.5 pt-1">
                  {keywords.slice(0, 4).map((keyword) => (
                    <span
                      class="
                        rounded-full px-2.5 py-0.5
                        text-[10px] font-medium
                        bg-skin-button-accent/25
                        text-skin-base
                        ring-1 ring-inset
                        ring-black/10 dark:ring-white/15
                      "
                    >
                      {keyword}
                    </span>
                  ))}
                </div>
              )}
            </div>

            <div
              class="
                skill-tooltip-arrow
                absolute top-full h-2.5 w-2.5
                -translate-x-1/2 rotate-45
                bg-skin-button-muted/75 dark:bg-skin-button-muted/65
                ring-1 ring-white/20 dark:ring-white/15
              "
            />
          </div>
        </div>
      ))}
    </div>
  </div>

  <style>
    :global(body[data-theme="luffy"]:not(.dark) .skills-grid .skill-item button) {
      background-color: rgba(var(--color-button-muted), 0.9);
    }

    :global(body[data-theme="luffy"]:not(.dark) .skills-grid .skill-item button:hover) {
      background-color: rgba(var(--color-button-muted), 0.95);
    }

    :global(body[data-theme="luffy"]:not(.dark) .skills-grid .skill-item button .skill-tooltip),
    :global(body[data-theme="luffy"]:not(.dark) .skills-grid .skill-item .skill-tooltip) {
      color: rgb(var(--color-text-base));
    }

    /* Desktop float */
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-3px); }
    }

    .skill-float {
      animation: float 6s ease-in-out infinite;
    }

    .skill-tooltip-arrow {
      left: 50%;
    }

    .skills-grid > .skill-item:nth-child(8n-7) .skill-tooltip,
    .skills-grid > .skill-item:nth-child(8n-6) .skill-tooltip {
      left: 0;
      right: auto;
      transform: translateX(0);
    }

    .skills-grid > .skill-item:nth-child(8n-7) .skill-tooltip-arrow,
    .skills-grid > .skill-item:nth-child(8n-6) .skill-tooltip-arrow {
      left: 1.5rem;
    }

    .skills-grid > .skill-item:nth-child(8n) .skill-tooltip,
    .skills-grid > .skill-item:nth-child(8n-1) .skill-tooltip,
    .skills-grid > .skill-item:nth-child(8n-2) .skill-tooltip {
      left: auto;
      right: 0;
      transform: translateX(0);
    }

    .skills-grid > .skill-item:nth-child(8n) .skill-tooltip-arrow,
    .skills-grid > .skill-item:nth-child(8n-1) .skill-tooltip-arrow,
    .skills-grid > .skill-item:nth-child(8n-2) .skill-tooltip-arrow {
      left: auto;
      right: 1.5rem;
      transform: translateX(50%) rotate(45deg);
    }

    @media (min-width: 1280px) {
      .skills-grid > .skill-item:nth-child(9n-8) .skill-tooltip,
      .skills-grid > .skill-item:nth-child(9n-7) .skill-tooltip {
        left: 0;
        right: auto;
        transform: translateX(0);
      }

      .skills-grid > .skill-item:nth-child(9n-8) .skill-tooltip-arrow,
      .skills-grid > .skill-item:nth-child(9n-7) .skill-tooltip-arrow {
        left: 1.5rem;
      }

      .skills-grid > .skill-item:nth-child(9n) .skill-tooltip,
      .skills-grid > .skill-item:nth-child(9n-1) .skill-tooltip,
      .skills-grid > .skill-item:nth-child(9n-2) .skill-tooltip {
        left: auto;
        right: 0;
        transform: translateX(0);
      }

      .skills-grid > .skill-item:nth-child(9n) .skill-tooltip-arrow,
      .skills-grid > .skill-item:nth-child(9n-1) .skill-tooltip-arrow,
      .skills-grid > .skill-item:nth-child(9n-2) .skill-tooltip-arrow {
        left: auto;
        right: 1.5rem;
        transform: translateX(50%) rotate(45deg);
      }
    }

    @media print {
      button {
        border: none;
        background: transparent;
        padding: 0;
      }
      [role='tooltip'] {
        display: none;
      }
    }
  </style>
</Section>
